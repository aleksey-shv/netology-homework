# Домашнее задание к занятию "`12.8 «Резервное копирование баз данных»`" - `Шведов Алексей`

---

### Задание 1. Резервное копирование

Кейс  

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.  

Необходимо описать, какие варианты резервного копирования подходят в случаях:  

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.  

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.  

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.  

Приведите ответ в свободной форме.

### Ответ:

1.1. Для этого случая подходит ежедневное полное резервное копирование данных. В конце каждого рабочего дня, система создает полную копию всех данных, которая сохраняется на отдельном надежном носителе. Таким образом, при необходимости восстановления данных за предыдущий день, компания сможет просто воспользоваться последним полным резервным копированием.  

1.2. Для обеспечения такого уровня надёжности подходит инкрементное резервное копирование данных. При этом каждый час создается копия только тех данных, которые были изменены с момента последнего полного или инкрементного копирования. Таким образом, в случае необходимости восстановления данных за час до предполагаемой поломки, компания сможет воспользоваться последним полным резервным копированием и последующим инкрементным, содержащим изменения за нужный час.  

1.3.* Да, возможен кейс, когда при поломке базы данных происходит моментальное переключение на работающую или подчиненную базу данных. Этот сценарий называется "High Availability" (высокая доступность) и является одним из основных принципов обеспечения надежности работы баз данных.  

Для достижения моментального переключения на работающую или подчиненную базу данных, компания может использовать различные методы и технологии, направленные на обеспечение непрерывности доступа к данным. Вот несколько способов решения данной проблемы:  

Репликация баз данных:  

Репликация - это процесс создания и поддержания точных копий базы данных (реплик) на отдельных серверах. Реплики могут располагаться на разных физических машинах или даже в разных географических регионах для повышения надежности. При поломке основной базы данных система автоматически переключается на работу с одной из реплик, что обеспечивает непрерывность доступа к данным. После восстановления основной базы данных, изменения с реплики синхронизируются обратно на основную базу.  

Кластеризация баз данных: 
 
Кластеризация предполагает объединение нескольких серверов или узлов в единое функциональное целое, работающее как единый узел. Кластер баз данных предоставляет высокую доступность и отказоустойчивость. Если один из серверов в кластере перестает работать из-за поломки, другие серверы автоматически принимают на себя его нагрузку, обеспечивая непрерывность работы.  

Горячее резервное копирование (Hot Backup):  

Горячее резервное копирование позволяет создавать резервные копии базы данных, не прерывая ее работы. Это достигается за счет использования специальных механизмов, которые позволяют копировать данные, даже если они активно используются приложениями и пользователями. Горячее резервное копирование дает компаниям возможность регулярно создавать точные копии базы данных в режиме реального времени, что обеспечивает высокую доступность данных и уменьшает риск потери информации при возникновении сбоев или аварий.  
Процесс горячего резервного копирования включает в себя использование специализированных инструментов и технологий, которые позволяют "замораживать" данные на короткий период времени, чтобы создать их копию. В это время приложения и пользователи могут продолжать работу с базой данных без изменений. Затем копия данных сохраняется в отдельном хранилище, которое может быть расположено на другом сервере или даже в другом физическом месте, чтобы обеспечить дополнительную защиту от потери данных в случае чрезвычайных ситуаций.  
Когда происходит поломка основной базы данных, компания может моментально переключиться на работу с резервной копией. Это позволяет минимизировать время простоя и уменьшить влияние на производственные процессы или обслуживание клиентов. Кроме того, при восстановлении основной базы данных, изменения, которые были сделаны во время работы с резервной копией, могут быть синхронизированы с основной базой для обновления данных.  

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).  

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?  

Приведите ответ в свободной форме.

### Ответ:

2.1. Команда для резервирования данных (pg_dump):  
pg_dump -U <имя_пользователя> -d <имя_базы_данных> -f <путь_к_файлу_резерва>
Пример использования:  
pg_dump -U myuser -d mydatabase -f /path/to/backup.sql  

Команда для восстановления данных (pg_restore):  
pg_restore -U <имя_пользователя> -d <имя_базы_данных> <путь_к_файлу_резерва>  
Пример использования:  
pg_restore -U myuser -d mydatabase /path/to/backup.sql

2.1.* Да, процесс резервирования и восстановления БД с помощью pg_dump/pg_restore может быть автоматизирован с использованием сценариев (скриптов) на языках программирования, таких как Bash, Python, PowerShell и других. Например, можно создать простые скрипты, чтобы выполнить регулярное резервное копирование базы данных и планировать выполнение этих скриптов по расписанию с помощью системы планирования задач операционной системы.

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.  

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?  

Приведите ответ в свободной форме.

### Ответ:

3.1. В качестве примера, я могу привести команду mysqldump, которую можно использовать для создания инкрементного резервного копирования базы данных MySQL.  

Команда mysqldump позволяет создавать дампы базы данных MySQL в файлы, которые содержат SQL-запросы для восстановления данных. Для создания инкрементного резервного копирования можно использовать опцию --single-transaction, которая обеспечивает консистентное состояние базы данных на момент начала копирования, и опцию --master-data, которая добавляет информацию о репликации в дамп.  

Вот пример команды для создания инкрементного резервного копирования базы данных MySQL с использованием mysqldump:  
mysqldump --single-transaction --master-data=2 --all-databases > incremental_backup.sql  

3.1.* Что касается преимуществ использования реплики по сравнению с обычным резервным копированием:  

Уменьшение влияния на производительность: Резервное копирование может быть довольно ресурсоемкой операцией, особенно для больших баз данных. Использование реплики позволяет выполнять резервное копирование на вторичном сервере (реплике), тем самым снижая нагрузку на основной сервер и минимизируя влияние на производительность во время резервного копирования.  

Непрерывность работы: Когда основной сервер работает, реплика постоянно получает данные с него и реплицирует изменения. Это означает, что в случае сбоя основного сервера вы можете быстро переключиться на реплику в качестве временной замены. Таким образом, репликация обеспечивает более быстрое восстановление данных и сокращение времени простоя.  

Географическая отказоустойчивость: Если реплика размещена на удаленном сервере или даже в другом дата-центре, это обеспечивает дополнительный уровень отказоустойчивости и защиты данных от сбоев и катастроф.  

Тестирование резервных копий: Репликация позволяет выполнять тестирование резервных копий без воздействия на основной сервер. Вы можете временно отключить репликацию и использовать реплику для восстановления и тестирования данных.  

Важно отметить, что репликация не является полной заменой резервному копированию. Идеальным решением для обеспечения безопасности данных является сочетание репликации для непрерывности работы и резервного копирования для создания точных точек восстановления в случае катастрофических сбоев.

---

